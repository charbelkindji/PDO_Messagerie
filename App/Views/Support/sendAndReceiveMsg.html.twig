<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script lang="js">

    // function LoadNewMessages() {
    //     $.ajax({
    //         url: 'support/newMessages',
    //         success: function(data) {
    //             console.log(data);
    //             // do something with the return value here if you like
    //         }
    //     });
    //     setTimeout(LoadNewMessages, 5000); // you could choose not to continue on failure...
    // }
    //
    //
    $(document).ready(function() {


        // setTimeout(LoadNewMessages, 5000);

        // Détecter l'appui sur la touche Entrée
        $('#messageBox').keypress(function(event){
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if(keycode == '13'){

                // get the form data
                // there are many ways to get this data using jQuery (you can use the class or id also)
                var formData = {
                    'message'              : $('input[name=message]').val(),
                    'iddest'              : {{ iddest }},
                    'idexp'              : {{ idexp }},
                    'typeexp'              : "{{ typeexp }}",
                    'typedest'              : "{{ typedest }}",
                };

                // process the form
                $.ajax({
                    type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
                    url         : 'http://localhost/PDO_Messagerie/public/support/processMessage', // the url where we want to POST
                    data        : formData, // our data object
                    dataType    : 'json', // what type of data do we expect back from the server
                    encode          : true
                })
                // using the done promise callback
                    .done(function(data) {

                        // log data to the console so we can see
                        console.log(data);

                        // ALL GOOD! just show the success message!
                        $('#chat-wrapper').append('<div class="float-right">'+
                            '<div class="chat-box-wrapper chat-box-wrapper-right">'+
                            '<div>'+
                            '<div class="chat-box">' + data.message + ' </div>'+
                            '<small class="opacity-6">'+
                            '<i class="fa fa-calendar-alt mr-1"></i>'+
                                data.date +
                            '</small>'+
                            '</div>'+
                            '<div>'+
                            '<div class="avatar-icon-wrapper ml-1">'+
                            '<div class="badge badge-bottom btn-shine badge-success badge-dot badge-dot-lg"></div>'+
                            '<div class="avatar-icon avatar-icon-lg rounded"><img'+
                        'src="http://localhost/PDO_Messagerie/public/assets/images/avatars/avatar.png" alt=""></div>'+
                            '</div>'+
                            '</div>'+
                            '</div>'+
                            '</div> <div style="height: 5px; clear: right;"></div>');

                        $('input[name=message]').val("");
                        // here we will handle errors and validation messages
                    });

                // stop the form from submitting the normal way and refreshing the page
                event.preventDefault();
            }
        });
    });



</script>